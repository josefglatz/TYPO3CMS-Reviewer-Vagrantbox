{
	"variables": {
		"provisioner": "chef",
		"provisioner_version": "",
		"provisioner_set_path": "",
		"iso_url": "http://releases.ubuntu.com/14.04/ubuntu-14.04-server-amd64.iso",
		"iso_checksum": "4d94f6111b8fe47da94396180ce499d8c0bb44f3"
	},
	"builders": [{
		"vm_name": "ubuntu1404",
		"type": "vmware-iso",
		"guest_os_type": "ubuntu-64",
		"http_directory": "http",
		"iso_url": "{{ user `iso_url` }}",
		"iso_checksum": "{{ user `iso_checksum` }}",
		"iso_checksum_type": "sha1",
		"ssh_username": "vagrant",
		"ssh_password": "vagrant",
		"ssh_wait_timeout": "10000s",
		"floppy_files": ["floppy/vmware9.compat_mm.patch", "floppy/vmware9.k3.8rc4.patch", "floppy/vmhgfs-d_count-kernel-3.11-tools-9.6.0.patch"],
		"tools_upload_flavor": "linux",
		"boot_command": [
			"<esc><esc><enter><wait>",
			"/install/vmlinuz auto",
			" console-setup/ask_detect=false",
			" console-setup/layoutcode=us",
			" console-setup/modelcode=pc105",
			" debconf/frontend=noninteractive",
			" debian-installer=en_US",
			" fb=false",
			" initrd=/install/initrd.gz",
			" kbd-chooser/method=de",
			" keyboard-configuration/layout=de",
			" keyboard-configuration/variant=de",
			" locale=en_US",
			" netcfg/get_domain=vm",
			" netcfg/get_hostname=vagrant",
			" noapic" ,
			" preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg",
			" -- ",
			"<enter>"
		],
		"shutdown_command": "echo 'vagrant'|sudo -S shutdown -P now",
		"disk_size": 40000,
		"vmx_data": {
		  "memsize": "1024",
		  "numvcpus": "2",
		  "cpuid.coresPerSocket": "1"
		}
	},
	{
		"vm_name": "ubuntu1404",
		"type": "virtualbox-iso",
		"http_directory": "http",
		"iso_url": "{{ user `iso_url` }}",
		"iso_checksum": "{{ user `iso_checksum` }}",
		"iso_checksum_type": "sha1",
		"guest_os_type": "Ubuntu_64",
		"guest_additions_path": "VBoxGuestAdditions_{{.Version}}.iso",
		"virtualbox_version_file": ".vbox_version",
		"ssh_username": "vagrant",
		"ssh_password": "vagrant",
		"ssh_wait_timeout": "10000s",
		"boot_command": [
			"<esc><esc><enter><wait>",
			"/install/vmlinuz noapic ",
			"preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
			"debian-installer=en_US auto locale=en_US kbd-chooser/method=us ",
			"hostname={{ .Name }} ",
			"fb=false debconf/frontend=noninteractive ",
			"keyboard-configuration/modelcode=SKIP keyboard-configuration/layout=USA ",
			"keyboard-configuration/variant=USA console-setup/ask_detect=false ",
			"initrd=/install/initrd.gz -- <enter>"
		],
		"shutdown_command": "echo 'vagrant'|sudo -S shutdown -P now",
		"disk_size": 40000,
		"vboxmanage": [
			["modifyvm", "{{.Name}}", "--memory", "1024"],
			["modifyvm", "{{.Name}}", "--cpus", "2"]
		]
	}],
	"provisioners": [
		{
			"type": "shell",
			"environment_vars": [
				"PROVISIONER={{user `provisioner`}}",
				"PROVISIONER_VERSION={{user `provisioner_version`}}",
				"PROVISIONER_SET_PATH={{user `provisioner_set_path`}}"
			],
			"execute_command": "echo 'vagrant' | {{.Vars}} sudo -E -S bash '{{.Path}}'",
			"scripts": [
				"script/base.sh",
				"script/vagrant.sh",
				"script/sshd.sh",
				"script/vmtools.sh",
				"script/provisioner.sh"
			]
		},
		{
			"type": "chef-solo",
			"skip_install": true,
			"cookbook_paths": ["../../berks-cookbooks", "../../site-cookbooks"],
			"run_list": [
				"recipe[environment::webmin]",
				"recipe[build-essential]",
				"recipe[git]",
				"recipe[environment::ruby]",
				"recipe[composer]",
				"recipe[sqlite]",
				"recipe[graphicsmagick]",
				"recipe[nginx]",
				"recipe[mysql::server]",
				"recipe[php]",
				"recipe[environment::php]",
				"recipe[database]",
				"recipe[database::mysql]"

				"recipe[MailCatcher]",
				"recipe[environment::mailcatcher]"
			],
			"json": {
				"mysql": {
					"server_root_password": "vagrant",
					"server_debian_password": "vagrant",
					"server_repl_password": "vagrant",
					"allow_remote_root": true
				},
				"php": {
					"directives": {}
				},
				"mailcatcher": {
					"http-ip": "0.0.0.0"
				}
			}
		},
		{
			"type": "shell",
			"environment_vars": [
				"PROVISIONER={{user `provisioner`}}",
				"PROVISIONER_VERSION={{user `provisioner_version`}}",
				"PROVISIONER_SET_PATH={{user `provisioner_set_path`}}"
			],
			"execute_command": "echo 'vagrant' | {{.Vars}} sudo -E -S bash '{{.Path}}'",
			"scripts": [
				"script/cleanup.sh",
				"script/zerodisk.sh"
			]
		}
	],
	"post-processors": [{
		"type": "vagrant",
		"keep_input_artifact": false,
		"output": "../../{{.Provider}}/ubuntu1404-{{user `provisioner`}}{{user `provisioner_version`}}.box"
	}]
}
